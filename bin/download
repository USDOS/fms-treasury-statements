#!/bin/sh
set -e

# Datestamp from input
if [ -z "$FMS" ]; then
  echo You must activate the FMS environment first.
elif [ "$#" = 1 ]; then
  datestamp=$(date -d "$1" +%y%m%d00)
else
  echo "USAGE: $0 [datestamp]"
  exit 1
fi

file=$(date -d "$1" +"$FMS/archive/%Y%m%d.txt")

# Skip things that are done.
test -e "$file" && exit

if ! wget -w 8 -O "$file" \
  "https://www.fms.treas.gov/fmsweb/viewDTSFiles?dir=w&fname=$datestamp.txt"; then
  rm "$file"
  exit 1
fi

